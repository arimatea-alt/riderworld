-- TRIAL DIEND LOOP - MODERN GUI (15s DELAY)
print("=== TRIAL AUTO MODERN LOADED ===")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("PlayerGui found")

-- Simple wait for remote
repeat task.wait(0.1) until ReplicatedStorage:FindFirstChild("Remote")
print("Remote folder found")

local RiderTrialRemote = ReplicatedStorage.Remote.Event:WaitForChild("RiderTrial", 10)
print("RiderTrial remote found:", RiderTrialRemote ~= nil)

-- Config
local LIVES_FOLDER_NAME = "Lives"
local BOSS_90_NAME = "Hunter Lv.90"
local DELAY_TIME = 15 -- 15 detik delay

-- Variables
local autoLoopEnabled = false
local waitingForRestart = false
local frameMinimized = false
local mainFrameHeight = 140
local miniFrameHeight = 50

-- Create MODERN GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TrialAutoGUI"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 100
screenGui.Parent = playerGui

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, mainFrameHeight)
mainFrame.Position = UDim2.new(0, 30, 0.3, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 16)
mainCorner.Parent = mainFrame

-- Gradient background
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 60)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 35))
}
gradient.Rotation = 45
gradient.Parent = mainFrame

-- Shadow effect
local shadow = Instance.new("Frame")
shadow.Size = UDim2.new(1, 8, 1, 8)
shadow.Position = UDim2.new(0, -4, 0, -4)
shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
shadow.BackgroundTransparency = 0.7
shadow.ZIndex = mainFrame.ZIndex - 1
shadow.Parent = screenGui

local shadowCorner = Instance.new("UICorner")
shadowCorner.CornerRadius = UDim.new(0, 20)
shadowCorner.Parent = shadow

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 45)
titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 16)
titleCorner.Parent = titleBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -60, 1, 0)
titleLabel.Position = UDim2.new(0, 15, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "üéÆ TRIAL DIEND LOOP"
titleLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

-- Minimize Button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -40, 0.5, -15)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.Text = "‚àí"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextScaled = true
minimizeBtn.Parent = titleBar

local minCorner = Instance.new("UICorner")
minCorner.CornerRadius = UDim.new(0, 8)
minCorner.Parent = minimizeBtn

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 30)
statusLabel.Position = UDim2.new(0, 15, 0, 55)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: LOADED ‚úì"
statusLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = mainFrame

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(1, -30, 0, 50)
toggleButton.Position = UDim2.new(0, 15, 0, 90)
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
toggleButton.Text = "üöÄ START LOOP"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.GothamBold
toggleButton.Parent = mainFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 12)
toggleCorner.Parent = toggleButton

-- Content Frame (untuk minimize)
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, 0, 1, -45)
contentFrame.Position = UDim2.new(0, 0, 0, 45)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- DRAG FUNCTION
local dragging = false
local dragStart, startPos
titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

titleBar.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        shadow.Position = UDim2.new(mainFrame.Position.X.Scale, mainFrame.Position.X.Offset - 4, mainFrame.Position.Y.Scale, mainFrame.Position.Y.Offset - 4)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- MINIMIZE ANIMATION
minimizeBtn.MouseButton1Click:Connect(function()
    frameMinimized = not frameMinimized
    if frameMinimized then
        minimizeBtn.Text = "+"
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 280, 0, miniFrameHeight)}):Play()
        TweenService:Create(contentFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 0)}):Play()
    else
        minimizeBtn.Text = "‚àí"
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 280, 0, mainFrameHeight)}):Play()
        TweenService:Create(contentFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 1, -45)}):Play()
    end
end)

-- Functions
local function joinTrial()
    if RiderTrialRemote then
        RiderTrialRemote:FireServer("Trial of Diend")
        StarterGui:SetCore("SendNotification", {Title = "‚ö° TRIAL", Text = "JOINED!", Duration = 2})
        print("TRIAL JOINED")
    end
end

local function updateStatus()
    local lives = workspace:FindFirstChild(LIVES_FOLDER_NAME)
    local boss90 = lives and lives:FindFirstChild(BOSS_90_NAME)
    
    if waitingForRestart then
        statusLabel.Text = "‚è≥ WAIT 15s..."
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    elseif boss90 then
        statusLabel.Text = "‚öîÔ∏è Lv.90 ALIVE"
        statusLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
    else
        statusLabel.Text = "‚úÖ READY"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
    end
end

-- Toggle Button Logic
toggleButton.MouseButton1Click:Connect(function()
    autoLoopEnabled = not autoLoopEnabled
    
    if autoLoopEnabled then
        toggleButton.Text = "‚èπÔ∏è STOP LOOP"
        toggleButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        statusLabel.Text = "üöÄ STARTING..."
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 255)
        joinTrial()
    else
        toggleButton.Text = "üöÄ START LOOP"
        toggleButton.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
        statusLabel.Text = "‚è∏Ô∏è STOPPED"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        waitingForRestart = false
    end
end)

-- Status Update Loop
task.spawn(function()
    while true do
        updateStatus()
        task.wait(0.5)
    end
end)

-- Boss Monitor
local livesConnection
local function startMonitoring()
    local lives = workspace:FindFirstChild(LIVES_FOLDER_NAME)
    if lives and not livesConnection then
        livesConnection = lives.ChildRemoved:Connect(function(child)
            if autoLoopEnabled and child.Name == BOSS_90_NAME then
                print("Lv.90 DIED - 15s timer start")
                waitingForRestart = true
                statusLabel.Text = "‚è≥ WAIT 15s..."
                statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                
                task.spawn(function()
                    task.wait(DELAY_TIME) -- 15 detik
                    if autoLoopEnabled then
                        print("15s done - restarting trial")
                        waitingForRestart = false
                        joinTrial()
                    end
                end)
            end
        end)
    end
end

task.spawn(function()
    while true do
        startMonitoring()
        task.wait(1)
    end
end)

-- Success Notification
StarterGui:SetCore("SendNotification", {
    Title = "üéÆ TRIAL AUTO", 
    Text = "Modern GUI LOADED! Drag title bar", 
    Duration = 5
})

print("=== MODERN GUI FULLY ACTIVE ===")